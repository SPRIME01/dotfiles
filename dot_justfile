# Global Justfile (managed by chezmoi)

# Display a list of available tasks when no target is specified.
default:
	@echo "=== Global Justfile Tasks ==="
	@just --list

# Bootstrap development environment
bootstrap:
	chezmoi apply
	@command -v mise >/dev/null 2>&1 && mise install || true
	@echo "Environment ready"

# Lint placeholder (customize per-language locally)
lint:
	@echo "No global lint configured; add project-specific linters"

# Format placeholder
format:
	@echo "No global formatter configured; add project-specific formatters"

# Install direnv across supported platforms (idempotent)
install-direnv:
	@bash -c 'set -euo pipefail; echo "ğŸŒ± Installing direnv..."; if command -v direnv >/dev/null 2>&1; then echo "âœ… direnv already installed: $$(command -v direnv)"; direnv version || true; exit 0; fi; OS=$$(uname -s); if command -v apt >/dev/null 2>&1; then echo "ğŸ“¦ Using apt"; sudo apt update -y >/dev/null 2>&1 || true; sudo apt install -y direnv; elif command -v brew >/dev/null 2>&1; then echo "ğŸº Using Homebrew"; brew install direnv; elif command -v dnf >/dev/null 2>&1; then echo "ğŸ“¦ Using dnf"; sudo dnf install -y direnv; elif command -v pacman >/dev/null 2>&1; then echo "ğŸ“¦ Using pacman"; sudo pacman -Sy --noconfirm direnv; elif command -v zypper >/dev/null 2>&1; then echo "ğŸ“¦ Using zypper"; sudo zypper install -y direnv; elif command -v scoop >/dev/null 2>&1; then echo "ğŸªŸ Using scoop (Windows)"; scoop install direnv; elif command -v choco >/dev/null 2>&1; then echo "ğŸªŸ Using choco (Windows)"; choco install direnv -y; else echo "âŒ No supported package manager found. Install manually from https://direnv.net"; exit 1; fi; if command -v direnv >/dev/null 2>&1; then echo "ğŸ‰ direnv installed: $$(direnv version)"; echo "ğŸ’¡ Create a .envrc in a project and run: direnv allow"; echo "ğŸ’¡ To disable temporarily: export DISABLE_DIRENV=1"; else echo "âŒ direnv installation appears to have failed"; exit 1; fi'

# ===== Windows chezmoi helpers (run from WSL) =====
windows-chezmoi-diff SRC="${HOME}/dotfiles":
	@bash -lc 'bash "$HOME/dotfiles/scripts/windows-chezmoi-diff.sh" "{{SRC}}"'

windows-chezmoi-apply SRC="${HOME}/dotfiles":
	@bash -lc 'bash "$HOME/dotfiles/scripts/windows-chezmoi-apply.sh" "{{SRC}}"'
