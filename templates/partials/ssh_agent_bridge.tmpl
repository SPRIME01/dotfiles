{{/* SSH agent bridge setup for WSL */}}
# SSH agent bridge integration (WSL optional)
if [[ -n "${WSL_DISTRO_NAME:-}" ]] || grep -qi microsoft /proc/version 2>/dev/null; then
  # Set default SSH_AUTH_SOCK if not already set
  export SSH_AUTH_SOCK="${SSH_AUTH_SOCK:-$HOME/.ssh/agent.sock}"

  # Check if bridge tools are available
  if command -v socat >/dev/null 2>&1 && (command -v npiperelay.exe >/dev/null 2>&1 || command -v npiperelay >/dev/null 2>&1); then
    # Bridge tools are available - attempt to use them
    if [[ ! -S "$SSH_AUTH_SOCK" ]]; then
      # Socket doesn't exist - bridge might not be running
      echo "⚠️ SSH agent bridge tools available but socket not found at $SSH_AUTH_SOCK"
      echo "💡 Run 'ssh-agent-bridge/preflight.sh' to diagnose bridge status"
    fi
  else
    # Bridge tools missing - graceful fallback
    echo "ℹ️ SSH agent bridge tools not found. Windows SSH keys won't be available in WSL."
    echo "💡 Install npiperelay and socat, then run 'scripts/setup-ssh-agent-bridge.sh'"
  fi

  # Helper function to check bridge status
  ssh-bridge-status() {
    local preflight_script="{{ .chezmoi.sourceDir }}/ssh-agent-bridge/preflight.sh"
    if [[ -f "$preflight_script" ]]; then
      "$preflight_script"
    else
      echo "Preflight script not found: $preflight_script"
      echo "Available SSH keys:"
      ssh-add -l 2>/dev/null || echo "No SSH keys loaded or agent not available"
    fi
  }
fi
